{% extends 'base.html' %}

{% block content %}

<hgroup style="margin-bottom: 1rem;">
    <h1 style="font-size: 1.5rem; margin-bottom: 0;">–ú—ñ–π –ü—Ä–æ—Ñ—ñ–ª—å</h1>
    <small style="color: #94a3b8;">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ç–∞ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è</small>
</hgroup>

<div class="dashboard-layout" style="grid-template-columns: 1fr 1fr 1fr;">

    <div class="dash-card" style="text-align: center;">
        <div style="padding: 1rem 0;">
            <div class="profile-avatar">
                {{ user.username|make_list|first|upper }}
            </div>
            <h2 style="margin-bottom: 0.25rem; font-size: 1.2rem;">{{ user.first_name }} {{ user.last_name }}</h2>
            <small style="color: var(--primary);">@{{ user.username }}</small>
            
            <div style="margin-top: 0.5rem;">
                {% if user.is_staff %}
                    <span style="background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">–¢–†–ï–ù–ï–†</span>
                {% else %}
                    <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">–ö–õ–Ü–Ñ–ù–¢</span>
                {% endif %}
            </div>
        </div>

        <div style="text-align: left; margin-top: 0.5rem; margin-bottom: 1rem;">
            <div class="info-row">
                <span class="info-label">Email</span>
                <span class="info-value">{{ user.email }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω</span>
                <span class="info-value">{{ user.phone_number|default:"‚Äî" }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</span>
                <span class="info-value">{{ user.date_joined|date:"d.m.Y" }}</span>
            </div>
        </div>

        <div class="dash-footer">
            <form action="{% url 'logout' %}" method="post" style="width: 100%; margin-bottom: 0;">
                {% csrf_token %}
                <button type="submit" class="secondary outline" style="width: 100%; font-size: 0.9rem;">
                    üö™ –í–∏–π—Ç–∏
                </button>
            </form>
        </div>
    </div>

    {% if user.is_staff %}
    
    <div class="dash-card">
        <div class="dash-header">üìù –ü—Ä–æ —Å–µ–±–µ</div>
        <div style="font-size: 0.9rem; color: #cbd5e1; line-height: 1.6; white-space: pre-line;">
            {{ user.bio|default:"–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–æ—Å–≤—ñ–¥ —â–µ –Ω–µ –¥–æ–¥–∞–Ω–∞." }}
        </div>

        {% comment %} <div class="dash-footer">
            <a href="/admin/users/customuser/{{ user.id }}/change/" target="_blank" role="button" class="primary outline" style="width: 100%; font-size: 0.9rem;">
                ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ
            </a>
        </div> {% endcomment %}
    </div>

    <div class="dash-card">
        <div class="dash-header">üìú –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</div>
        {% if certificates %}
            <ul class="dash-list">
            {% for cert in certificates %}
                <li>
                    <strong style="color: #fff; display: block;">{{ cert.title }}</strong>
                    <small style="color: #94a3b8;">{{ cert.issued_by }} ‚Ä¢ {{ cert.date_issued|date:"Y" }}</small>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <div style="text-align: center; color: #94a3b8; padding: 2rem 0;">
                –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ —â–µ –Ω–µ –¥–æ–¥–∞–Ω—ñ.
            </div>
        {% endif %}
        <div class="dash-footer"></div>
    </div>

    {% else %}

    <div class="dash-card">
        <div class="dash-header">üìä –§—ñ–∑–∏—á–Ω–∏–π —Å—Ç–∞–Ω</div>
        
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="stat-box">
                <div class="stat-value">{{ stat.weight }}</div>
                <div class="stat-label">–í–∞–≥–∞ (–∫–≥)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ stat.height }}</div>
                <div class="stat-label">–ó—Ä—ñ—Å—Ç (—Å–º)</div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 1rem;">
            <small style="color: #94a3b8;">–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: {{ stat.updated_at|date:"d.m.Y" }}</small>
        </div>
        <div class="dash-footer"></div>
    </div>

    <div class="dash-card">
        <div class="dash-header">üèÜ –û—Å—Ç–∞–Ω–Ω—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è</div>
        {% if recent_records %}
            <ul class="dash-list">
            {% for rec in recent_records %}
                <li style="display: flex; justify-content: space-between;">
                    <div>
                        <span style="display: block; color: #fff;">{{ rec.exercise_name }}</span>
                        <small style="color: #94a3b8;">{{ rec.created_at|date:"d.m" }}</small>
                    </div>
                    <div style="text-align: right;">
                        <strong style="color: var(--primary);">{{ rec.result_value }}</strong>
                        {% if rec.rpe %}
                        <br><small style="font-size: 0.7em; color: #f59e0b;">RPE {{ rec.rpe }}</small>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <div style="text-align: center; color: #94a3b8; padding: 2rem 0;">
                –©–µ –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å.
            </div>
        {% endif %}
        <div class="dash-footer" style="text-align: right;">
            <a href="{% url 'schedule' %}" style="font-size: 0.85rem; text-decoration: none;">–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–Ω—è—Ç—å ‚Üí</a>
        </div>
    </div>

    {% endif %}

</div>
{% endblock %}