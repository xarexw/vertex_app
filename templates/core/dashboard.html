{% extends 'base.html' %}

{% block content %}

<hgroup style="margin-bottom: 1rem;">
    <h1 style="font-size: 1.5rem; margin-bottom: 0;">–í—ñ—Ç–∞—î–º–æ, {{ user.first_name|default:user.username }}!</h1>
    <small style="color: #94a3b8;">
        {% if user.is_staff %}üõ†Ô∏è –ü–∞–Ω–µ–ª—å –¢—Ä–µ–Ω–µ—Ä–∞{% else %}–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∫–∞–±—ñ–Ω–µ—Ç{% endif %}
    </small>
</hgroup>


{% if user.is_staff %}
<div class="dashboard-layout" style="grid-template-columns: repeat(3, 1fr);">
    
    <div class="dash-card">
        <div class="dash-header">‚ö° –ü—É–ª—å—Ç –¢—Ä–µ–Ω–µ—Ä–∞</div>
        <div class="grid" style="gap: 0.75rem; display: flex; flex-direction: column; height: 100%; justify-content: center;">
            <a href="/admin/" role="button" class="primary" style="width: 100%; margin-bottom: 0;">
                ‚öôÔ∏è –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
            </a>
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0;">
                <a href="{% url 'schedule' %}" role="button" class="secondary outline" style="font-size: 0.8em; padding: 0.5rem;">üìÖ –†–æ–∑–∫–ª–∞–¥</a>
                <a href="{% url 'profile' %}" role="button" class="contrast outline" style="font-size: 0.8em; padding: 0.5rem;">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</a>
            </div>
        </div>
    </div>

    <div class="dash-card" style="position: relative; overflow: hidden; border-color: var(--primary);">
        <div class="dash-header" style="color: var(--primary);">üöÄ –ù–∞—Å—Ç—É–ø–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</div>
        
        {% if trainer_sessions %}
            {% with next_session=trainer_sessions.0 %}
            <div style="text-align: center; padding: 0.5rem 0; flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                <div class="metric-big" style="font-size: 2.2rem; color: #fff;">{{ next_session.start_time|date:"H:i" }}</div>
                <div style="font-size: 1.1rem; color: var(--primary); font-weight: bold;">{{ next_session.title }}</div>
                <small style="color: #94a3b8; margin-top: 0.5rem;">{{ next_session.start_time|date:"d.m.Y" }}</small>
            </div>
            
            <div class="dash-footer">
                <a href="{% url 'session_manage' next_session.id %}" role="button" style="width: 100%; background-color: #ef4444; border-color: #ef4444; font-weight: bold; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);">
                    üî¥ –ó–ê–ü–£–°–¢–ò–¢–ò LIVE
                </a>
            </div>
            {% endwith %}
        {% else %}
            <div style="text-align: center; padding: 2rem 0; color: #94a3b8; display: flex; align-items: center; justify-content: center; height: 100%;">
                <div>üèñÔ∏è<br>–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫</div>
            </div>
        {% endif %}
    </div>

    <div class="dash-card">
        <div class="dash-header">üìã –î–∞–ª—ñ —É —Ä–æ–∑–∫–ª–∞–¥—ñ</div>
        <ul class="dash-list">
            {% if trainer_sessions and trainer_sessions|length > 1 %}
                {% for session in trainer_sessions|slice:"1:" %} <li style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem;">
                        <span style="color: #fff;">{{ session.start_time|date:"H:i" }}</span>
                        <span style="color: #94a3b8;">{{ session.title }}</span>
                    </li>
                {% endfor %}
            {% else %}
                <li style="color: #94a3b8; text-align: center; padding: 1rem 0; list-style: none;">
                    –ë—ñ–ª—å—à–µ –∑–∞–Ω—è—Ç—å –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –Ω–µ–º–∞—î.
                </li>
            {% endif %}
        </ul>
        <div class="dash-footer" style="text-align: right;">
            <a href="{% url 'schedule' %}" style="font-size: 0.8rem; text-decoration: none; color: var(--primary);">–í–µ—Å—å –≥—Ä–∞—Ñ—ñ–∫ ‚Üí</a>
        </div>
    </div>

</div>


{% else %}
<div class="dashboard-layout" style="grid-template-columns: repeat(3, 1fr);">

    <div class="dash-card" style="position: relative; overflow: hidden;">
        <div class="dash-header">üé´ –ú—ñ–π –ê–±–æ–Ω–µ–º–µ–Ω—Ç</div>
        
        {% if has_active_sub %}
            <div style="position: absolute; top: 1rem; right: 1rem; color: #10b981; font-size: 0.85rem;">
                ‚úÖ –ê–∫—Ç–∏–≤–Ω–∏–π
            </div>
            
            <div style="text-align: center; padding: 1rem 0;">
                <div class="metric-big">{{ days_left }}</div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 1rem;">–¥–Ω—ñ–≤ –∑–∞–ª–∏—à–∏–ª–æ—Å—å</div>
                <progress class="slim" value="{{ days_left }}" max="30"></progress>
                <small>–î–æ: {{ sub_end_date|date:"d E Y" }}</small>
            </div>
        {% else %}
            <div style="text-align: center; padding: 1.5rem 0;">
                 <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ùå</div>
                 <p>–£ –≤–∞—Å –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞.</p>
            </div>
            <div class="dash-footer">
                <a href="{% url 'subscription_list' %}" role="button" style="width: 100%;">üíé –ö—É–ø–∏—Ç–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç</a>
            </div>
        {% endif %}
    </div>


    <div class="dash-card">
        <div class="dash-header">üîî –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–¥—ñ—ó</div>
        <ul class="dash-list">
            {% for note in notifications %}
                <li>{{ note.title }}</li>
            {% empty %}
                <li style="color: #94a3b8; text-align: center; padding: 1rem 0;">–ù–æ–≤–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å –Ω–µ–º–∞—î</li>
            {% endfor %}
        </ul>
        
        <div class="dash-footer" style="text-align: right;">
            <a href="{% url 'notifications' %}" style="font-size: 0.85rem; text-decoration: none;">–í—Å—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è ‚Üí</a>
        </div>
    </div>


    <div class="dash-card">
        <div class="dash-header">‚ö° –ù–∞–≤—ñ–≥–∞—Ü—ñ—è</div>
        <div style="display: flex; flex-direction: column; gap: 0.5rem; height: 100%;">
            <a href="{% url 'schedule' %}" role="button" class="secondary outline" style="flex-grow: 1; display: flex; align-items: center; justify-content: center;">
                üìÖ –†–æ–∑–∫–ª–∞–¥ –∑–∞–ª—É
            </a>
            <a href="{% url 'profile' %}" role="button" class="contrast outline" style="flex-grow: 1; display: flex; align-items: center; justify-content: center;">
                üë§ –ú—ñ–π –ü—Ä–æ—Ñ—ñ–ª—å —ñ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </a>
        </div>
    </div>

</div>
{% endif %}

{% endblock %}